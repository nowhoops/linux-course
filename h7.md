#  h7 Final Stretch

- **Task from teacher (Karvinen, Linux Servers)**  
- **Author:** [whoops]  
- **Date:** 2025-10-06  
- **Course:** Linux Systems and Networking  
- **Computer:** i7-14700K / 5070 Ti / 64 GB RAM / Fedora OS
- **Server:**  1core / 1GB / Storage 10GB

---

## a) Hello World in Three Languages
I created and ran a simple "Hello World" program in **Python**, **C**, and **Bash**.

### 🐍 Python
**Create a file:**
### 🕥 17:10
```bash
nano hello.py
```bash

**Paste**
```python
from datetime import datetime

# current time
now = datetime.now()

# time as string
current_time = now.strftime("%Y-%m-%d %H:%M:%S")

# Print output
print("Current time:", current_time)
print("Hello world")
```
**CTRL + O > Enter > CTRL + X** 

**Run:**

```bash
python3 hello.py
```
<img width="323" height="115" alt="image" src="https://github.com/user-attachments/assets/2ba88ff5-a260-4b06-a3df-06aa8a001ca7" />

---

### C
### 🕥 17:20
```bash
sudo apt update
sudo apt install build-essential
```
**Create a file:**
```bash
nano hello.py
```

**Paste**
```bash
#include <stdio.h>

int main() {
    printf("Hello world\n");
    return 0;
}

```
**CTRL + O > Enter > CTRL + X** 

**Compile and run:**

```bash
gcc hello.c -o hello
./hello
```
<img width="349" height="61" alt="image" src="https://github.com/user-attachments/assets/0d6427de-0a77-465c-b18e-c1858ab44e31" />

(Geeksforgeeks,2025)(Prakash,2023)
---

### Bash
### 🕥 17:35
```bash
nano hello.sh
```

**Paste**
```bash
#!/bin/bash
echo "Hello world (: "
```
**CTRL + O > Enter > CTRL + X** 

**Make executable and run:**

```bash
chmod +x hello.sh
./hello.sh
```
<img width="347" height="81" alt="image" src="https://github.com/user-attachments/assets/5421ee34-3e6d-49af-ba26-865c290d880d" />

---

## c) Create Custom Linux Command for All Users
### 🕥 17:48
I created a command that test network is ok

**Create a file:**
```bash
nano nettest.py
```
**Paste**
```bash
#!/bin/bash
# nettest - simple network check

echo " Pinging heema.fi..."
ping -c 3 heema.fi

echo ""
echo "Testing connection to 1.1.1.1 ..."
ping -c 3 1.1.1.1

echo ""
echo " Network test finished."
```

**CTRL + O > Enter > CTRL + X**
###  Make it executable and move to `/usr/local/bin`:

```bash
chmod +x nettest
sudo cp nettest /usr/local/bin/
```

###  Test the command:

```bash
nettest
```
<img width="913" height="405" alt="image" src="https://github.com/user-attachments/assets/e99f33bf-8443-4732-ae5d-ef806a3ecd56" />


---
### 🕥 21:25

## d) Solved Old Lab Task: H3 Server Hardening (Karvinen, 2017)
- Because this was an old task and kind of an exam, I didn’t follow all the rules and made some changes.
- Also, at this point, I’ve been in a job crunch and haven’t slept that well these past two weeks, so pardon if there are some typos.
- I also wanted to make it less tedious to create all these users, so I’m planning to write a script that, when executed, asks for the username, password, and whether the user should be a sudo user or something else.

## Part 1
### NinjaDatabase
- Connected to my site with ssh
```bash
ssh user@site.site
```
### 1.1 Update system
```bash
sudo apt update && sudo apt upgrade -y

```
### 1.2 Install Apache and others
- Tried to install mysql but:
```bash
Package mysql-server is not available, but is referred to by another package.
This may mean that the package is missing, has been obsoleted, or
is only available from another source
However the following packages replace it:
  mariadb-server


Error: Package 'mysql-server' has no installation candidate
```
- changed it to mariaadb-server

```bash
sudo apt update && sudo apt install -y apache2 mariadb-server php libapache2-mod-php php-mysql
```
php, n.d. https://www.php.net/manual/en/extensions.alphabetical.php
**Installed:**
- Apache2 
- MySQL Server 
- PHP and common modules:
**Start and enable Apache and MySQL**
```bash
sudo systemctl enable apache2
sudo systemctl enable mysql
``` 
### site is up (it was up before also)
### SSH is also running

## Part 2 (hard part)

****Create a file:**
```bash
 nano create_User_Website.sh
```
**Paste**
```bash
#!/bin/bash

WEBROOT="/var/www"
APACHE_CONF_DIR="/etc/apache2/sites-available"
DOMAIN="heema.fi"  

while true; do
  echo -n "Username: "
  read username

  if [[ ! "$username" =~ ^[a-z][-a-z0-9_]*$ ]]; then (gnu.org, n.d.)
    echo "try again! Use only lowercase and numbers"
    continue
  fi

  echo -n "Full name (for webpage title): "
  read fullname

  echo -n "Password: "
  read -s password
  echo

  echo -n "Make user a sudo? (y/n): "
  read sudo_answer

  # Create user and pass
  sudo useradd -m "$username"
  echo "$username:$password" | sudo chpasswd

  if [[ "$sudo_answer" == "y" ]]; then
    sudo usermod -aG sudo "$username"
  fi

  echo "User '$username' created."

  USER_WEB_DIR="$WEBROOT/$username.$DOMAIN"
  sudo mkdir -p "$USER_WEB_DIR"

  # Create the HTML page 
  # Used the html code from task H3 (whoops, 2025)
  sudo tee "$USER_WEB_DIR/index.html" > /dev/null <<EOF
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>$fullname</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #ff7e5f, #feb47b);
      font-family: 'Poppins', sans-serif;
    }
    h1 {
      font-size: 6rem;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.5rem;
      cursor: pointer;
      transition: transform 0.3s ease, color 0.3s ease;
    }
    h1:hover {
      transform: scale(1.2) rotate(-5deg);
      color: #ffd700;
    }
  </style>
</head>
<body>
  <h1>$fullname</h1>
</body>
</html>
EOF

  # Set ownership to user
  sudo chown -R "$username":"$username" "$USER_WEB_DIR"

  # Apache virtual host configuration for both HTTP and HTTPS (the https is  not workking)
  sudo tee "$APACHE_CONF_DIR/$username.$DOMAIN.conf" > /dev/null <<EOF
<VirtualHost *:80>
    ServerName $username.$DOMAIN
    DocumentRoot /var/www/$username.$DOMAIN
    <Directory /var/www/$username.$DOMAIN>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    ErrorLog \${APACHE_LOG_DIR}/error.log
    CustomLog \${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName $username.$DOMAIN
    DocumentRoot /var/www/$username.$DOMAIN
    <Directory /var/www/$username.$DOMAIN>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/$DOMAIN/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/$DOMAIN/privkey.pem
    ErrorLog \${APACHE_LOG_DIR}/error.log
    CustomLog \${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
EOF

  
  sudo a2ensite "$username.$DOMAIN.conf"
  sudo a2enmod ssl
  sudo systemctl reload apache2

  # Install SSL with Certbot
  if ! command -v certbot &>/dev/null; then
    echo "Certbot is not installed. Installing..."
    sudo apt-get install certbot python3-certbot-apache -y
    sudo certbot --apache -d "$username.$DOMAIN"
  fi

  echo -n "another one? (y/n): "
  read again
  if [[ "$again" != "y" ]]; then
    echo "Done."
    break
  fi
done


``` 

**CTRL + O > Enter > CTRL + X** 

```bash
chmod +x create_User_Website.sh
```
**To run**
```bash
./create-user-website.sh
```
<img width="905" height="445" alt="image" src="https://github.com/user-attachments/assets/7d7c185b-a063-4caa-91fb-8644bc39b95a" />
<img width="675" height="47" alt="image" src="https://github.com/user-attachments/assets/0a07a684-969e-4fa0-af59-5ebf9fc6de74" />


**Problem**
- Main domain SSL worked, but subdomains couldn't find their certificates.
- Spent hour of troubleshooting, thinking I broke something.
- The real issue(most of the time): I forgot to reload Apache after changes, which caused the server to stop working.

Troubleshooting Steps (shortly)
- Noticed SSL wasn't working for subdomains, but the main domain SSL was fine.
- Assumed the subdomains should have their own certificates.
**Check Apache Configurations:**
- Verified Apache configurations for subdomains and main domain.
- Ensured the virtual host configurations were correct
- Checked the Apache error logs, which showed red text indicating missing SSL certificates for subdomains.

**What we learned**
- check logs to save time on trying to figure out the problem. (:

# This did not save time



<img width="1233" height="957" alt="image" src="https://github.com/user-attachments/assets/b8b3ac36-d7e5-4dff-ba94-b5270a9f2ccf" />
<img width="1228" height="1073" alt="image" src="https://github.com/user-attachments/assets/59ba1a0c-f4e8-421c-916e-0f46a5568c56" />

**To show all users**
```bash

ls /home | awk 'length($0) > 9'
```

<img width="459" height="101" alt="image" src="https://github.com/user-attachments/assets/c82c8b53-26cb-4a0a-bb10-fd5a30d25696" />







## 3) Create Custom Linux Command for All Users
### 🕥 01:48


**Create a file:**
```bash
nano ninja
```
**Paste**
```bash
#!/bin/bash

echo " Hello Ninja..."


**CTRL + O > Enter > CTRL + X**
###  Make it executable and move to `/usr/local/bin`:

```bash
chmod +x ninja
sudo cp ninja /usr/local/bin/
```

###  Test the command:

```bash
ninja
```


## 5) Ninja moves
### 🕥 01:52
#### Create file for Eija's ninja moves

#### **Access MariaDB** by running the following command:(Ebrahim, 2024.)
 
    ```bash
    sudo mysql -u root -p
    ```

#### **Create the database** and the table to store the ninja moves:

    ```sql
    CREATE DATABASE sneaky_garden;
    USE sneaky_garden;

    CREATE TABLE moves (
        id INT AUTO_INCREMENT PRIMARY KEY,
        name VARCHAR(255) NOT NULL,
        difficulty INT NOT NULL
    );

    -- Insert sample data
    INSERT INTO moves (name, difficulty) VALUES
    ('Hyppykiertopotku', 27),
    ('Kuperkeikka', 3),
    ('Karjaisu', 1);
    ```
Now that your database is ready, let's set up the Node.js project.

1. **Create the project directory**:

    ```bash
    mkdir SneakyGarden
    cd SneakyGarden
    ```

2. **Initialize the Node.js project**:

    ```bash
    npm init -y
    ```

3. **Install the required dependencies**:

    - **Express**: A web framework for Node.js
    - **mysql2**: A MySQL client that is compatible with MariaDB
    - **EJS**: Template engine to render dynamic HTML

    ```bash
    npm install express mysql2 ejs
    ```

---

### 4. **Create Express Server (server.js)**

Create a `server.js` file in the project folder to configure the web server.

```js
const express = require('express');
const mysql = require('mysql2');
const app = express();
const port = 3000;

// Set up MariaDB connection
const db = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: 'your_password',  // Replace with your MariaDB root password
  database: 'sneaky_garden'
});

db.connect((err) => {
  if (err) throw err;
  console.log('Connected to the MariaDB database!');
});

// Set EJS as the template engine
app.set('view engine', 'ejs');
app.use(express.static('public'));

// Routes
app.get('/', (req, res) => {
  db.query('SELECT * FROM moves', (err, result) => {
    if (err) throw err;
    res.render('index', { moves: result });
  });
});

// Start the server
app.listen(port, () => {
  console.log(`Server is running at http://localhost:${port}`);


#### inside your projekt folder create a views folder
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sneaky Garden - Ninja Moves</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <h1>Sneaky Garden - Ninja Moves</h1>
  
  <div id="moves-list">
    <ul>
      <% moves.forEach(move => { %>
        <li><strong><%= move.name %></strong> (Difficulty: <%= move.difficulty %>)</li>
      <% }) %>
    </ul>
  </div>

  <footer>
    <p>Managed by Eija</p>
  </footer>
</body>
</html>




---






































---












## Sources

- Karvinen, Tero. **Linux Servers**  
  [https://terokarvinen.com/linux-palvelimet/](https://terokarvinen.com/linux-palvelimet/)

- Karvinen, Tero. **Shell Scripting (2007)**  
  [https://terokarvinen.com/2007/a-shell-script-hello-world/](https://terokarvinen.com/2007/a-shell-script-hello-world/)

- Geeksforgeeks, 2025. https://www.geeksforgeeks.org/c/c-hello-world-program/
- Abhishek Prakash 04 Sep 2023 https://itsfoss.com/build-essential-ubuntu/
Tero Karvinen, 2017. https://terokarvinen.com/2017/arvioitava-laboratorioharjoitus-linux-palvelimet-ict4tn021-4-tiistai-alkusyksy-2017-5-op/****
- php, n.d. https://www.php.net/manual/en/extensions.alphabetical.php

- https://github.com/nowhoops/linux-course/blob/main/h3-WebServer.md

- gnu.org, n.d. https://www.gnu.org/software/bash/manual/html_node/Bash-Conditional-Expressions.html
- Mokhtar Ebrahim, 2024.https://likegeeks.com/mysql-on-linux-beginners-tutorial/
